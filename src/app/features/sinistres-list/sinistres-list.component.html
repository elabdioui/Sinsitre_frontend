<!-- src/app/features/sinistres-list/sinistres-list.component.html -->

<section class="page">
    <div class="shell">
      <!-- HEADER -->
      <header class="page-header">
        <div>
          <h1>Gestion des sinistres</h1>
          <p>Suivi des d√©clarations de sinistres et de leurs statuts.</p>
        </div>
  
        <div class="header-actions">
          <div class="chips">
            <span class="chip chip--neutral">
              Total : <strong>{{ totalSinistres }}</strong>
            </span>
            <span class="chip chip--blue">
              D√©clar√©s : <strong>{{ declares }}</strong>
            </span>
            <span class="chip chip--green">
              Valid√©s : <strong>{{ valides }}</strong>
            </span>
            <span class="chip chip--red">
              Refus√©s : <strong>{{ refuses }}</strong>
            </span>
          </div>
  
          <button type="button" class="btn-secondary" (click)="loadSinistres()">
            ‚ü≥ Actualiser
          </button>
        </div>
      </header>
  
      <!-- CARD PRINCIPALE -->
      <div class="card">
        <div class="card-header">
          <div>
            <h2>Liste des sinistres</h2>
            <p>Vue globale des demandes d‚Äôindemnisation des clients.</p>
          </div>
        </div>
  
        <div class="card-body">
          <!-- √âtats -->
          <div *ngIf="loading" class="state state--info">
            Chargement des sinistres...
          </div>
  
          <div *ngIf="error && !loading" class="state state--error">
            {{ error }}
          </div>
  
          <div
            *ngIf="!loading && !error && (!sinistres || sinistres.length === 0)"
            class="empty"
          >
            <div class="empty-icon">üìù</div>
            <h3>Aucun sinistre enregistr√©</h3>
            <p>
              Aucun sinistre n‚Äôa encore √©t√© d√©clar√©. Les enregistrements
              appara√Ætront ici.
            </p>
          </div>
  
          <!-- TABLEAU -->
          <div
            *ngIf="!loading && !error && sinistres && sinistres.length > 0"
            class="table-wrapper"
          >
            <table class="table">
              <thead>
                <tr>
                  <th>N¬∞ sinistre</th>
                  <th>Client</th>
                  <th>Montant demand√©</th>
                  <th>Description</th>
                  <th>Statut</th>
                  <th class="col-actions">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let s of sinistres">
                  <td>
                    <span class="strong">{{
                      s.numeroSinistre || ('#' + s.id)
                    }}</span>
                  </td>
                  <td>
                    <div class="cell-main">
                      <span class="cell-title">
                        Client {{ s.clientId }}
                      </span>
                      <span class="cell-sub">
                        {{ s.clientNom || 'Nom non disponible' }}
                      </span>
                      <span class="cell-sub subtle">
                        {{ s.clientEmail || 'Email non disponible' }}
                      </span>
                    </div>
                  </td>
                  <td>
                    <span class="strong">
                      {{ s.montantDemande || 0 | number: '1.0-0' }} DH
                    </span>
                  </td>
                  <td class="col-description">
                    {{ s.description || '‚Äî' }}
                  </td>
                  <td>
                    <span
                      class="status-pill"
                      [ngClass]="{
                        'status-pill--gray': s.statut === 'DECLARE',
                        'status-pill--blue': s.statut === 'EN_COURS',
                        'status-pill--green': s.statut === 'VALIDE',
                        'status-pill--red': s.statut === 'REFUSE'
                      }"
                    >
                      {{ s.statut || 'N/A' }}
                    </span>
                  </td>
                  <td class="col-actions">
                    <div class="actions">
                      <button
                        type="button"
                        class="btn-ghost-small"
                        (click)="updateStatut(s, 'EN_COURS')"
                      >
                        En cours
                      </button>
                      <button
                        type="button"
                        class="btn-ghost-small btn-ghost-small--green"
                        (click)="updateStatut(s, 'VALIDE')"
                      >
                        Valider
                      </button>
                      <button
                        type="button"
                        class="btn-ghost-small btn-ghost-small--red"
                        (click)="updateStatut(s, 'REFUSE')"
                      >
                        Refuser
                      </button>
                      <button
                        type="button"
                        class="btn-link-danger"
                        (click)="deleteSinistre(s)"
                      >
                        Supprimer
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </section>
  