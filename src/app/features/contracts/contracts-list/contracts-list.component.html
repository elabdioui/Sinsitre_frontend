<!-- src/app/features/contracts-list/contracts-list.component.html -->

<div class="contracts-page">
  <!-- ğŸ“Š HEADER + STATS -->
  <header class="page-header">
    <div class="header-top">
      <div>
        <h1>ğŸ“‘ Gestion des Contrats d'Assurance</h1>
        <p class="subtitle">Liste complÃ¨te de tous les contrats</p>
      </div>
      <button class="btn-primary" (click)="loadContracts()">
        ğŸ”„ Actualiser
      </button>
    </div>

    <!-- Stats Cards -->
    <div class="stats-row">
      <div class="stat-card stat-total">
        <span class="stat-value">{{ stats.total }}</span>
        <span class="stat-label">Total</span>
      </div>
      <div class="stat-card stat-active">
        <span class="stat-value">{{ stats.active }}</span>
        <span class="stat-label">Actifs</span>
      </div>
      <div class="stat-card stat-canceled">
        <span class="stat-value">{{ stats.canceled }}</span>
        <span class="stat-label">AnnulÃ©s</span>
      </div>
      <div class="stat-card stat-expired">
        <span class="stat-value">{{ stats.expired }}</span>
        <span class="stat-label">ExpirÃ©s</span>
      </div>
    </div>
  </header>

  <!-- ğŸ” FILTRES -->
  <section class="filters-bar">
    <input
      type="text"
      class="search-input"
      placeholder="ğŸ” Rechercher (type, client, email...)"
      [(ngModel)]="searchTerm"
      (ngModelChange)="onSearchChange()"
    />

    <select
      class="status-filter"
      [(ngModel)]="selectedStatus"
      (ngModelChange)="onStatusChange()"
    >
      <option *ngFor="let opt of statusOptions" [value]="opt.value">
        {{ opt.label }}
      </option>
    </select>
  </section>

  <!-- âš ï¸ ERREUR -->
  <div *ngIf="error" class="alert alert-error">
    {{ error }}
  </div>

  <!-- â³ LOADING -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Chargement des contrats...</p>
  </div>

  <!-- ğŸ“‹ LISTE DES CONTRATS -->
  <section *ngIf="!loading" class="contracts-section">
    <!-- Message si aucun rÃ©sultat -->
    <div *ngIf="filteredContracts.length === 0" class="empty-state">
      <span class="empty-icon">ğŸ“­</span>
      <p>Aucun contrat trouvÃ©</p>
    </div>

    <!-- Tableau des contrats -->
    <div *ngIf="filteredContracts.length > 0" class="contracts-table-wrapper">
      <table class="contracts-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Type de Contrat</th>
            <th>Client</th>
            <th>Prime Annuelle</th>
            <th>DÃ©but</th>
            <th>Fin</th>
            <th>Statut</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let contract of filteredContracts" class="contract-row">
            <td class="td-id">#{{ contract.id }}</td>
            <td class="td-type">
              <div class="type-cell">
                <span class="type-icon">ğŸ›¡ï¸</span>
                <span class="type-name">{{ contract.type }}</span>
              </div>
            </td>
            <td class="td-client">
              <div class="client-cell">
                <span class="client-name">{{ contract.clientNom || 'N/A' }}</span>
                <span class="client-email">{{ contract.clientEmail || '-' }}</span>
              </div>
            </td>
            <td class="td-price">{{ formatCurrency(contract.primeAnnuelle) }}</td>
            <td class="td-date">{{ formatDate(contract.startDate) }}</td>
            <td class="td-date">{{ formatDate(contract.endDate) }}</td>
            <td class="td-status">
              <span class="status-badge" [ngClass]="getStatusBadgeClass(contract.status)">
                {{ getStatusLabel(contract.status) }}
              </span>
            </td>
            <td class="td-actions">
              <button
                *ngIf="contract.status === 'ACTIVE'"
                class="btn-cancel"
                (click)="cancelContract(contract)"
                title="Annuler le contrat"
              >
                âŒ
              </button>
              <span *ngIf="contract.status !== 'ACTIVE'" class="no-action">-</span>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </section>
</div>
